@page "/"


@inject NavigationManager Nav
@inject IWebHostEnvironment Env

<div class="home-bg d-flex align-items-center justify-content-center">
    <div class="text-center mt-5 no-focus-wrapper">
        <h1 style="font-weight:700; color:var(--text);">Jogar</h1>
    </div>

    <div class="d-flex align-items-center justify-content-center mt-4" style="min-height: calc(100vh - 160px);">
        <div class="d-grid gap-3" style="width:420px;">
            <button class="btn btn-lg" style="background:var(--primary); color:#00121a; font-weight:700; padding:14px;" >Online(Em breve...)</button>
            <button class="btn btn-lg" style="background:var(--accent); color:#00121a; font-weight:700; padding:14px;" @onclick="GoLocal">Local</button>
        </div>
    </div>
</div>

<style>
    .btn:hover { filter: brightness(1.1); }
    .home-bg {
        min-height: 100vh;
        background-image: url('@(BackgroundUrl)');
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        /* Optional dark overlay for readability */
        position: relative;
    }
    .home-bg::before{
        content: "";
        position: absolute; inset: 0; background: rgba(0,0,0,.25);
    }
    .home-bg > * { position: relative; z-index: 1; }
</style>

@code {
    private string? BackgroundUrl;

    protected override void OnInitialized()
    {
        var rnd = Random.Shared;
        var candidates = EnumerateBackgroundUrls().ToList();
        if (candidates.Count > 0)
        {
            BackgroundUrl = candidates[rnd.Next(candidates.Count)];
        }
        else
        {
            // fallback (keeps previous visual if no files found)
            BackgroundUrl = "/images/mr_monopoly/bg_niteroi_inativo.png";
        }
    }

    private IEnumerable<string> EnumerateBackgroundUrls()
    {
        // Directories to scan relative to wwwroot
        var dirs = new[]
        {
            "images/mr_monopoly/stages bg images",
            "images/mr_monopoly/bgimages",
            "images/bgimages",
            "images/backgrounds"
        };
        foreach (var dir in dirs)
        {
            var contents = Env.WebRootFileProvider.GetDirectoryContents(dir);
            if (!contents.Exists) continue;
            foreach (var f in contents)
            {
                if (f.IsDirectory) continue;
                if (!IsImage(f.Name)) continue;
                // Build an url-encoded path: "/" + encoded dir + "/" + encoded filename
                var encodedDir = string.Join('/', dir.Split('/', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries).Select(Uri.EscapeDataString));
                var encodedFile = Uri.EscapeDataString(f.Name);
                yield return $"/{encodedDir}/{encodedFile}";
            }
        }
    }

    private static bool IsImage(string name)
        => name.EndsWith(".png", StringComparison.OrdinalIgnoreCase)
        || name.EndsWith(".jpg", StringComparison.OrdinalIgnoreCase)
        || name.EndsWith(".jpeg", StringComparison.OrdinalIgnoreCase)
        || name.EndsWith(".webp", StringComparison.OrdinalIgnoreCase)
        || name.EndsWith(".gif", StringComparison.OrdinalIgnoreCase);

    private void GoMultiplayer() => Nav.NavigateTo("#");
    private void GoLocal() => Nav.NavigateTo("/local");
}
