@using UFF.Monopoly.Entities
@inherits ComponentBase

<div class="players-hud floating" style="@HudStyle">
    <div class="players-hud-header">Jogadores</div>
    <div class="players-hud-list players-hud-grid">
        @if (Players is not null)
        {
            @for (int i = 0; i < Players.Count; i++)
            {
                var p = Players[i];
                var isCurrent = (i == CurrentPlayerIndex);
                var bankrupt = p.IsBankrupt;
                var pawnUrl = GetPawnUrl(p);
                <div class="player-card @(isCurrent ? "current" : string.Empty) @(bankrupt ? "bankrupt" : string.Empty)">
                    <div class="player-card-row">
                        <img src="@pawnUrl" alt="pawn" class="pawn-icon" />
                        <div class="player-name">@p.Name</div>
                        @if (isCurrent)
                        {
                            <div class="turn-indicator">Sua vez</div>
                        }
                    </div>
                    <div class="player-card-row values-row">
                        <div class="money" title="Dinheiro">$ @p.Money</div>
                        <div class="asset" title="Patrimônio total">Patrimônio: @p.AssetScore</div>
                    </div>
                </div>
            }
        }
    </div>
    <div class="turn-actions-container">
        @if (ShowRollButton)
        {
            <button class="btn btn-primary turn-btn roll-btn" @onclick="OnRollDice">Rolar Dados</button>
        }
        @if (ShowEndTurnButton)
        {
            <button class="btn btn-secondary turn-btn" @onclick="OnEndTurn">Encerrar Turno</button>
        }
    </div>
</div>

@code {
    [Parameter] public IReadOnlyList<Player>? Players { get; set; }
    [Parameter] public int CurrentPlayerIndex { get; set; } = -1;
    [Parameter] public Func<int,string>? PawnUrlResolver { get; set; }
    [Parameter] public string? HudStyle { get; set; }
    [Parameter] public bool ShowRollButton { get; set; }
    [Parameter] public bool ShowEndTurnButton { get; set; }
    [Parameter] public EventCallback OnRollDice { get; set; }
    [Parameter] public EventCallback OnEndTurn { get; set; }

    private string GetPawnUrl(Player p)
        => PawnUrlResolver?.Invoke(p.PawnIndex) ?? $"images/pawns/PawnsB{p.PawnIndex}.png";
}
