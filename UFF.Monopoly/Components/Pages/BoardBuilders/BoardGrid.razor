@using UFF.Monopoly.Data.Entities
@using UFF.Monopoly.Entities
@using UFF.Monopoly.Components.Shared

@inherits ComponentBase

<div class="board-grid" style="grid-template-columns: repeat(@Cols, @(CellSize + "px")); grid-auto-rows: @(CellSize + "px");">
    @for (var r = 0; r < Rows; r++)
    {
        for (var c = 0; c < Cols; c++)
        {
            if (CellToIndex.TryGetValue((r, c), out var index))
            {
                var b = index >= 0 && index < Blocks.Count ? Blocks[index] : null; 
                if (b is null)
                {
                    <div class="grid-cell empty"></div>
                }
                else
                {
                    <div class="grid-cell perimeter position-relative" style="--cell-size:@(CellSize)px" title="@($"{TranslateBlockType(b.Type)} - {b.Name}")">
                        <BlockIcon ImageUrl="@b.ImageUrl"
                                   Name="@b.Name"
                                   Description="@b.Description"
                                   Price="@b.Price"
                                   Rent="@b.Rent"
                                   Type="@b.Type"
                                   BuildingType="@b.BuildingType"
                                   BuildingLevel="@((int)(b.Level ?? 0))"
                                   OnClick="@(e => OnCellClick?.Invoke(index, e))" />
                    </div>
                }
            }
            else
            {
                <div class="grid-cell empty"></div>
            }
        }
    }
</div>

@code {
    [Parameter] public int Rows { get; set; }
    [Parameter] public int Cols { get; set; }
    [Parameter] public int CellSize { get; set; }
    [Parameter] public List<BlockTemplateEntity> Blocks { get; set; } = new(); 
    [Parameter] public Dictionary<(int r, int c), int> CellToIndex { get; set; } = new(); 
    [Parameter] public Func<BlockTemplateEntity, string> GetCellBackground { get; set; } = default!; 
    [Parameter] public Func<BlockType, string> TranslateBlockType { get; set; } = default!; 
    [Parameter] public Action<int, Microsoft.AspNetCore.Components.Web.MouseEventArgs>? OnCellClick { get; set; }
}
